# =============================================================================
# GitLab CI/CD Variables — Example / Template
# =============================================================================
# This file documents every variable the pipeline understands.
# DO NOT commit real credentials here — set them in GitLab instead:
#   Settings → CI/CD → Variables
# =============================================================================

# -----------------------------------------------------------------------------
# Pipeline behaviour variables
# These can be set as project defaults OR overridden per-run via
# "Run pipeline → Variables" in the GitLab UI.
# -----------------------------------------------------------------------------

RUN_TESTS:
  description: >
    Set to "false" to skip the test suite and only compile the binary.
    The scan-and-store job still runs; this only shortens the build stage.
    Use for quick scans when time is limited.
  value: "true"        # default — run tests on every build
  masked: false
  protected: false

SYNC_NETBOX:
  description: >
    Set to "true" to push the freshly scanned inventory into NetBox after
    the scan completes. Requires NETBOX_URL and NETBOX_TOKEN to be set.
    When "false" (default) only the in-repo inventory files are updated.
  value: "false"
  masked: false
  protected: false

INVENTORY_DIR:
  description: >
    Sub-folder inside this repository where the Markdown and JSON inventory
    reports are committed by the scan-and-store job.
    Changing this does NOT move existing files; create a migration commit
    manually if you rename it.
  value: "inventory"
  masked: false
  protected: false

# -----------------------------------------------------------------------------
# Git push-back credentials
# The scan-and-store job commits updated inventory files back to this repo.
# GL_TOKEN_WRITE is the recommended method; CI_JOB_TOKEN is the fallback.
# -----------------------------------------------------------------------------

GL_TOKEN_WRITE:
  description: >
    Project access token with write_repository scope used to push inventory
    commits back to this repository. This is the preferred push-back method
    and works regardless of CI_JOB_TOKEN push settings.
    Create at: Settings → Access Tokens → Add token
                (role: Developer or higher, scope: write_repository)
    When this variable is absent the pipeline falls back to CI_JOB_TOKEN,
    which requires "Allow CI Job Token to push" to be enabled at:
    Settings → CI/CD → Token Access.
  value: "REPLACE_WITH_YOUR_PROJECT_ACCESS_TOKEN"
  masked: true
  protected: false

# -----------------------------------------------------------------------------
# TLS / CA certificate (for self-signed or private GitLab instances)
# -----------------------------------------------------------------------------

CA_Chain:
  description: >
    PEM-encoded CA certificate chain for your GitLab instance.
    Set this as a "File" type variable (not "Variable") so that GitLab
    writes the content to a temporary file and exposes its path via $CA_Chain.
    Both the git operations and the scanner binary will automatically trust
    this certificate.
    Required only when your GitLab is served over a self-signed or private CA.
  value: "REPLACE_WITH_PEM_CONTENT_OR_USE_FILE_TYPE"
  masked: false
  protected: false

# -----------------------------------------------------------------------------
# iDRAC credentials
# Mark these as Masked (and Protected for production) in the GitLab UI.
# -----------------------------------------------------------------------------

IDRAC_DEFAULT_USER:
  description: "Default username for iDRAC authentication"
  value: "root"
  masked: true
  protected: false

IDRAC_DEFAULT_PASS:
  description: "Default password for iDRAC authentication"
  value: "REPLACE_WITH_YOUR_PASSWORD"
  masked: true
  protected: true

# -----------------------------------------------------------------------------
# NetBox integration (only required when SYNC_NETBOX=true)
# -----------------------------------------------------------------------------

NETBOX_URL:
  description: "NetBox API base URL, e.g. https://netbox.example.com"
  value: "https://netbox.yourdomain.com"
  masked: false
  protected: false

NETBOX_TOKEN:
  description: "NetBox API authentication token"
  value: "REPLACE_WITH_YOUR_NETBOX_TOKEN"
  masked: true
  protected: true

# -----------------------------------------------------------------------------
# Optional tuning
# -----------------------------------------------------------------------------

IDRAC_LOG_LEVEL:
  description: "Logging level: debug, info, warn, error"
  value: "info"
  masked: false
  protected: false

IDRAC_CONCURRENCY:
  description: "Maximum number of parallel iDRAC scans"
  value: "10"
  masked: false
  protected: false

IDRAC_DEFAULT_TIMEOUT:
  description: "Per-host connection timeout in seconds"
  value: "60"
  masked: false
  protected: false

# =============================================================================
# Quick-start: common pipeline invocations
# =============================================================================
#
# Fast scan (no tests, store results in repo, skip NetBox):
#   RUN_TESTS=false  SYNC_NETBOX=false
#
# Full run (tests + store in repo, skip NetBox):
#   RUN_TESTS=true   SYNC_NETBOX=false
#
# Full run + NetBox push:
#   RUN_TESTS=true   SYNC_NETBOX=true
#
# In all cases the scan-and-store job is MANUAL — go to the pipeline view
# in GitLab and click the ▶ Play button to trigger it.
#
# =============================================================================
# One-time setup: allow CI to push back to this repo
# =============================================================================
#
# Option A (recommended): Set GL_TOKEN_WRITE to a project access token with
#   write_repository scope. Works out of the box on any GitLab instance.
#
# Option B (fallback): Enable CI_JOB_TOKEN push access at:
#   Settings → CI/CD → Token Access → "Allow CI Job Token to push to this project"
#   On self-hosted GitLab instances this is often already permitted by default.
#
# =============================================================================
